<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>Saviora</title>
  <link rel="icon" type="image/png" href="src/savlogo.png">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --primary: #2563eb;
      --primary-hover: #1d4ed8;
      --secondary: #64748b;
      --accent: #06b6d4;
      --background: #bdcff1;
      --card-bg: rgba(255, 255, 255, 0.92);
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --success: #10b981;
      --warning: #f59e0b;
      --error: #ef4444;
      --border: rgba(0, 0, 0, 0.1);
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);

      --chat-bg: rgba(255,255,255,0.8);
      --menu-bg: rgba(255,255,255,0.98);
      --menu-text: #111827;
    }

    html, body { height: 100%; }
    body {
      font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Arial, sans-serif;
      margin: 0;
      padding: 16px;
      background: var(--background);
      color: var(--text-primary);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    h1 { font-size: 24px; margin: 0 0 20px; text-align: center; font-weight: 700; color: var(--text-primary); }
    h3 { font-size: 18px; font-weight: 600; margin: 0 0 16px 0; color: var(--text-primary); }

    .row { width: 100%; max-width: 520px; margin: 0 auto; }
    .card {
      width: 100%; max-width: 520px; margin: 0 auto; background: var(--card-bg);
      border-radius: 16px; padding: 24px; box-shadow: var(--shadow);
      backdrop-filter: blur(10px); border: 1px solid var(--border); animation: fadeIn 0.3s ease-out;
    }

    .center-wrap {
      min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center;
      max-width: 640px; margin: 0 auto; padding: 24px 8px; box-sizing: border-box;
    }

    @media (max-width: 900px) {
      .center-wrap { min-height: 0; max-width: 100vw; padding: 16px 4vw 24px; justify-content: flex-start; }
      .row, .card { max-width: 100vw; width: 100%; min-width: 0; box-sizing: border-box; }
      .card { padding: 20px; border-radius: 12px; }
    }

    textarea, input, button { font: inherit; border: none; outline: none; }

    textarea {
      width: 100%; padding: 16px; border-radius: 12px; font-size: 16px; line-height: 1.5;
      box-sizing: border-box; resize: none; background: rgba(255,255,255,0.8);
      border: 1px solid var(--border); transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }
    textarea:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(37,99,235,0.1); }
    #dream { min-height: 120px; max-height: 120px; }

    /* 1) –ü–∞–Ω–µ–ª—å –≤–≤–æ–¥–∞ ‚Äî —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞, —á—Ç–æ–±—ã –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä—ã–≥–∞–ª–æ */
    .chat-input-bar {
      position: relative;
      width: 100%;
      min-height: 56px;            /* —Ñ–∏–∫—Å–∏—Ä—É–µ–º –≤—ã—Å–æ—Ç—É –ø–∞–Ω–µ–ª–∏ */
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 0;              /* –≤–µ—Ä—Ö/–Ω–∏–∑ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ */
      box-sizing: border-box;
    }

    /* 2) –ü–æ–ª–µ ‚Äî —Ñ–∏–∫—Å. –≤—ã—Å–æ—Ç–∞ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Ç–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞ */
    #userInput {
      width: 100%;
      height: 40px;                /* –º–µ–Ω—å—à–µ –≤—ã—Å–æ—Ç—ã –ø–∞–Ω–µ–ª–∏ */
      min-height: 40px;
      max-height: 40px;
      padding: 8px 108px 8px 14px; /* —Å–ø—Ä–∞–≤–∞ –º–µ—Å—Ç–æ –ø–æ–¥ 2 –∫–Ω–æ–ø–∫–∏ + –∑–∞–∑–æ—Ä */
      border-radius: 20px;
      font-size: 15px;
      line-height: 22px;           /* —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ */
      resize: none;
      overflow: hidden;            /* –Ω–∏–∫–∞–∫–∏—Ö –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –ø–æ–ª–æ—Å */
      background: rgba(255,255,255,0.97);
      border: 1px solid var(--border);
      box-sizing: border-box;
      transition: border-color 0.15s ease, box-shadow 0.15s ease;
      -webkit-appearance: none;
      appearance: none;
      -webkit-text-size-adjust: 100%;
    }

    /* 3) –ö–Ω–æ–ø–∫–∏ ‚Äî –ø—Ä–∏–≤—è–∑–∫–∞ –∫ –ø–∞–Ω–µ–ª–∏ (–∞ –Ω–µ –∫ –ø–æ–ª—é) –ø–æ –Ω–∏–∂–Ω–µ–π –∫—Ä–æ–º–∫–µ */
    .send-icon-btn,
    .attach-icon-btn {
      position: absolute;
      bottom: 10px;               /* 8px –ø–∞–¥–¥–∏–Ω–≥ –ø–∞–Ω–µ–ª–∏ + 2px –æ–ø—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–Ω–æ—Å */
      top: auto;
      transform: none;
      width: 36px;
      height: 36px;
      border-radius: 18px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: none;
      transition: background-color 0.15s ease;
    }

    .attach-icon-btn { right: 68px; background: #fff; color: var(--text-primary); border: 1px solid var(--border); font-size: 18px; }
    .send-icon-btn   { right: 20px; background: var(--primary); color: #fff; border: none; font-size: 16px; }

    .attach-icon-btn:hover { background: rgba(0,0,0,0.04); }
    .send-icon-btn:hover   { background: var(--primary-hover); }

    /* 4) –ú–µ–Ω—é —Å–∫—Ä–µ–ø–∫–∏ ‚Äî –æ—Ç—Ç–∞–ª–∫–∏–≤–∞–µ–º –æ—Ç –Ω–∏–∂–Ω–µ–π –∫—Ä–æ–º–∫–∏ –ø–∞–Ω–µ–ª–∏, –Ω–µ –æ—Ç –ø–æ–ª—è */
    .attach-menu {
      position: absolute;
      right: 20px;                /* –≤—ã—Ä–æ–≤–Ω–µ–Ω–æ —Å send-icon-btn */
      bottom: 56px;               /* –≤—ã—Å–æ—Ç–∞ –ø–∞–Ω–µ–ª–∏ */
      transform: none;
      background: var(--menu-bg);
      color: var(--menu-text);
      border-radius: 12px;
      padding: 8px 0;
      box-shadow: 0 12px 32px rgba(0,0,0,0.15);
      min-width: 220px;
      z-index: 10;
      animation: fadeIn 0.15s ease-out;
      border: 1px solid var(--border);
      display: none;              /* –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∫—Ä—ã—Ç–æ */
    }
    .attach-item { width: 100%; text-align: left; background: transparent; border: none; color: var(--menu-text); padding: 10px 14px; font-size: 14px; cursor: pointer; }
    .attach-item:hover { background: rgba(0,0,0,0.04); }
    .attach-item:disabled { opacity: 0.5; cursor: default; }

    .controls { display: flex; gap: 12px; flex-wrap: wrap; margin-top: 20px; }
    button {
      padding: 12px 20px; border-radius: 12px; background: white; cursor: pointer; font-weight: 500; font-size: 14px;
      transition: background-color 0.2s ease, box-shadow 0.2s.ease; border: 1px solid var(--border);
      color: var(--text-primary); box-shadow: var(--shadow);
    }
    button:hover { box-shadow: 0 6px 12px -1px rgba(0,0,0,0.15); }
    button:active { transform: none; }
    button.primary { background: var(--primary); color: white; border: none; font-weight: 600; }
    button.primary:hover { background: var(--primary-hover); }
    button.secondary { background: transparent; border: 1px solid var(--border); color: var(--text-secondary); }
    button.secondary:hover { background: rgba(0,0,0,0.05); }

    .dream-view {
      line-height: 1.6; background: rgba(255,255,255,0.8); padding: 20px; border-radius: 12px;
      border: 1px dashed var(--border); min-height: 120px; white-space: pre-wrap; font-size: 16px;
    }

    .blocks { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 16px; }
    .chip {
      padding: 8px 16px; border-radius: 20px; background: #e0f2fe; color: #0369a1; cursor: pointer; border: none; font-size: 14px; font-weight: 500;
      transition: background-color 0.2s ease, transform 0.2s ease;
    }
    .chip:hover { background: #bae6fd; transform: translateY(-1px); }
    .chip.active { background: var(--primary); color: white; box-shadow: var(--shadow); }

    .chat {
      display: flex; flex-direction: column; gap: 12px; height: 280px; overflow: auto; padding: 20px;
      border-radius: 16px; background: var(--chat-bg); border: 1px solid var(--border);
    }

    .msg { max-width: 85%; padding: 12px 16px; border-radius: 18px; font-size: 15px; line-height: 1.4; word-wrap: break-word; overflow-wrap: anywhere; }
    .bot { background: #f1f5f9; color: var(--text-primary); align-self: flex-start; border: 1px solid #e2e8f0; }
    .user { background: var(--primary); color: white; align-self: flex-end; border: none; }

    .msg.bot.final { background: #e0f2fe; color: #0c4a6e; border: 1px solid #bae6fd; }
    .msg.final-global { background: linear-gradient(135deg, #fef3c7, #fed7aa); border-left: 4px solid #f59e0b; color: #78350f; }

    .quick { display: flex; gap: 8px; margin-top: 12px; flex-wrap: wrap; }
    .muted { color: var(--text-secondary); font-size: 14px; margin: 8px 0; }

    .footer { margin-top: 20px; display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }

    .chat-wrap { position: relative; }
    .jump-bottom-btn {
      position: absolute; right: 12px; bottom: 12px; width: 36px; height: 36px; border-radius: 18px;
      background: var(--primary); color: #fff; border: none; box-shadow: var(--shadow); cursor: pointer;
      display: none; opacity: 0.96; font-size: 18px; line-height: 1; transition: background-color 0.2s ease;
    }
    .jump-bottom-btn:hover { background: var(--primary-hover); }

    .nav-previews { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 14px; align-items: stretch; }
    .block-preview {
      min-height: 52px; max-height: 52px; border-radius: 12px; border: 1px dashed var(--border); box-shadow: var(--shadow);
      padding: 8px; font-size: 12px; color: var(--text-primary); opacity: 0.95; cursor: pointer;
      display: flex; align-items: center; justify-content: center; text-align: center; transition: opacity 0.2s ease, background-color 0.2s ease;
      user-select: none; overflow: hidden;
    }
    .block-preview .label {
      display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-width: 100%; line-height: 1.25;
    }
    .block-preview.disabled { cursor: default; filter: grayscale(0.2); opacity: 0.8; }

    .dialog-header { display: flex; align-items: center; gap: 8px; margin-bottom: 12px; }
    .back-link {
      display: inline-flex; align-items: center; justify-content: center; width: 28px; height: 28px; border-radius: 8px;
      border: 1px solid var(--border); background: #fff; color: var(--text-primary); font-weight: 700; cursor: pointer; box-shadow: var(--shadow);
    }
    .back-link:hover { background: rgba(0,0,0,0.04); }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

    .thinking {
      margin-top: 8px; font-size: 12px; color: var(--text-secondary); display: none; align-items: center; gap: 8px; justify-content: flex-start;
    }
    .dots::after { content: '...'; animation: dots 1.2s steps(4, end) infinite; }
    @keyframes dots {
      0% { content: ''; } 25% { content: '.'; } 50% { content: '..'; } 75% { content: '...'; } 100% { content: ''; }
    }

    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); border-radius: 3px; }
    ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--primary-hover); }
  </style>
</head>
<body>
  <div id="auth" style="display:none;">
    <div class="auth-bg" style="position:absolute;inset:0;background:var(--background);opacity:0.95;z-index:1;"></div>
    <div class="auth-card" style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:2;">
      <div style="background:var(--card-bg);box-shadow:0 20px 60px rgba(0,0,0,0.2);border-radius:24px;padding:40px 32px;min-width:340px;max-width:90vw;display:flex;flex-direction:column;align-items:center;backdrop-filter:blur(20px);border:1px solid var(--border);">
        <h2 style="font-size:24px;font-weight:700;margin-bottom:24px;color:var(--text-primary);text-align:center;">–î–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω</h2>
        <input type="password" id="authPass" placeholder="–ü–∞—Ä–æ–ª—å" style="font-size:16px;padding:16px;border-radius:12px;border:1px solid var(--border);margin-bottom:20px;width:100%;max-width:280px;background:rgba(255,255,255,0.8);transition:all 0.2s ease;text-align:center;">
        <button id="authBtn" style="font-size:16px;padding:16px 32px;border-radius:12px;border:none;background:var(--primary);color:#fff;font-weight:600;cursor:pointer;transition:all 0.2s ease;width:100%;max-width:280px;">–í–æ–π—Ç–∏</button>
        <div id="authError" style="color: var(--error); margin-top: 16px; display: none; font-size: 14px;">–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å</div>
      </div>
    </div>
  </div>

  <div class="center-wrap">
    <h1>Saviora</h1>

    <div id="step1">
      <div class="row">
        <div class="card">
          <h3>–ú—ã –≤—Å–µ–≥–¥–∞ —Ä–∞–¥—ã –Ω–æ–≤—ã–º –∏—Å—Ç–æ—Ä–∏—è–º</h3>
          <textarea id="dream" placeholder="–ó–∞–ø–∏—à–∏—Ç–µ —Å–≤–æ–µ —Å–Ω–æ–≤–∏–¥–µ–Ω–∏–µ..."></textarea>
          <div class="controls">
            <button id="toStep2" class="primary">–î–∞–ª–µ–µ ‚Üí</button>
          </div>
        </div>
      </div>
    </div>

    <div id="step2" style="display:none;">
      <div class="row">
        <div class="card">
          <h3>–°–º—ã—Å–ª–æ–≤—ã–µ –±–ª–æ–∫–∏</h3>
          <p class="muted">–í—ã–¥–µ–ª–∏—Ç–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç —Ç–µ–∫—Å—Ç–∞ –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫¬ª –∏–ª–∏ ¬´–í–µ—Å—å —Ç–µ–∫—Å—Ç¬ª</p>
          <div class="dream-view" id="dreamView"></div>
          <div class="controls">
            <button id="addBlock" class="secondary">–î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫</button>
            <button id="addWholeBlock" class="secondary">–í–µ—Å—å —Ç–µ–∫—Å—Ç</button>
          </div>
          <div class="blocks" id="blocks"></div>
          <div class="controls">
            <button id="backTo1" class="secondary">‚Üê –ù–∞–∑–∞–¥</button>
            <button id="toStep3" class="primary">–î–∞–ª–µ–µ ‚Üí</button>
          </div>
        </div>
      </div>
    </div>

    <div id="step3" style="display:none;">
      <div class="row">
        <div class="card">
          <div class="dialog-header">
            <button id="backTo2Header" class="back-link" title="–ù–∞–∑–∞–¥ –∫ –±–ª–æ–∫–∞–º">&lt;</button>
            <h3 style="margin:0;">–î–∏–∞–ª–æ–≥ –ø–æ –≤–∞—à–µ–º—É —Å–Ω–æ–≤–∏–¥–µ–Ω–∏—é</h3>
          </div>

          <div id="currentBlock" class="muted">–ë–ª–æ–∫ –Ω–µ –≤—ã–±—Ä–∞–Ω</div>

          <div class="chat chat-wrap" id="chat">
            <button id="jumpToBottom" class="jump-bottom-btn" title="–í –∫–æ–Ω–µ—Ü">‚ñº</button>
          </div>

          <div id="thinking" class="thinking">
            <span>–î—É–º–∞—é</span><span class="dots"></span>
          </div>

          <div class="footer">
            <div id="chatInputBar" class="chat-input-bar" style="width:100%;">
              <textarea id="userInput" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –æ—Ç–≤–µ—Ç..." rows="1"></textarea>
              <button id="attachBtn" class="attach-icon-btn" title="–î–µ–π—Å—Ç–≤–∏—è">üìé</button>
              <button id="sendAnswerBtn" class="send-icon-btn" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å">‚û§</button>
              <div id="attachMenu" class="attach-menu">
                <button id="menuBlockInterpret" class="attach-item">üìñ –¢–æ–ª–∫–æ–≤–∞–Ω–∏–µ</button>
                <button id="menuFinalInterpret" class="attach-item">üéØ –ò—Ç–æ–≥</button>
              </div>
            </div>
          </div>

          <div class="nav-previews">
            <div id="prevPreview" class="block-preview disabled"><span class="label">‚Ä¶</span></div>
            <div id="nextPreview" class="block-preview"><span class="label"></span></div>
          </div>

          <div style="display:none;">
            <button id="blockInterpretBtn">–¢–æ–ª–∫–æ–≤–∞–Ω–∏–µ</button>
            <button id="finalInterpretBtn">–ò—Ç–æ–≥</button>
            <button id="prevBlockBtn">‚óÄ</button>
            <button id="nextBlockBtn">‚ñ∂</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="src/main.js"></script>
</body>
</html>
